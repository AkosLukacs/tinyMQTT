(function(){function k(b){if(3===b.charCodeAt(0)>>4){var c=b.charCodeAt(2)<<8|b.charCodeAt(3);b={topic:b.substr(4,c),message:b.substr(4+c,b.charCodeAt(1)-c)};a.emit("message",b)}}function f(a){return e(a.length>>8,a.length&255)+a}function h(a,c,d){return e(a,c.length+d.length)+c+d}function l(b){var c=0;b=f(b);a.usr&&a.pwd&&(c|=a.usr?128:0,c|=a.usr&&a.pwd?64:0,b+=f(a.usr)+f(a.pwd));c=e(parseInt(c.toString(16),16));return h(16,f("MQTT")+"\u0004"+c+"\u00ff\u00ff",b)}var a,g=function(b,c){var d=c||{};
this.svr=b;this.prt=d.port||1883;this.ka=d.keep_alive||60;this.usr=d.username;this.pwd=d.password;this.cn=!1;this.ri=d.reconnect_interval||2E3;a=this},e=String.fromCharCode;g.prototype.connect=function(){var b=function(){clearInterval(c);a.cl.write(l(getSerial()));a.emit("connected");a.cn=!0;setInterval(function(){a.cn&&a.cl.write(e(192)+"\x00")},a.ka<<10);a.cl.on("data",k.bind(a));a.cl.on("end",function(){a.cn&&a.emit("disconnected");a.cn=!1;delete a.cl});a.removeAllListeners("connected")};if(!a.cn)var c=
setInterval(function(){a.cl&&(a.cl.end(),delete a.cl);a.cl=require("net").connect({host:a.svr,port:a.prt},b)},a.ri)};g.prototype.subscribe=function(b){a.cl.write(h(130,e(256,1),f(b)+e(1)))};g.prototype.publish=function(b,c){a.cn&&(a.cl.write(h(49,f(b),c)),a.emit("published"))};g.prototype.disconnect=function(){a.cl.write(e(224)+"\x00")};exports.create=function(a,c){return new g(a,c)}})();